<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link href="../assets/img/LogoAzulEscuro.svg" rel="icon" />
    <title id="titulo-pagina">Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css" />

    <link href="../assets/css/dashboard.min.css" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/2eecc47c4e.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./css/style.css" />
    <script src="./js/main.js"></script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body id="page-top" class="" onload="iniciarSessao(pagina)">
    <div id="wrapper">
        <!-- Sidebar -->
        <my-sidebar></my-sidebar>
        <!-- Sidebar -->
        <div id="content-wrapper" class="d-flex flex-column">
            <div id="content">
                <!-- TopBar -->
                <my-topbar></my-topbar>
                <!-- Topbar -->

                <!-- Container Fluid-->
                <div class="container-fluid px-lg-4" id="container-wrapper">
                    <div class="row">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800" id="titulo-macAdress">MAC</h1>

                            <div class="botoes">
                                <input id="btn-gerenciarProcessos" class="dropdown-toggle btn btn-primary btn-sm"
                                    type="button" value="Gerenciar Processos" />
                                <input id="btn-gerenciarComponentes" class="dropdown-toggle btn btn-primary btn-sm"
                                    type="button" value="Gerenciar Componentes" />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div id="container_cards" class="row"></div>

                            <!-- Area Chart -->
                            <hr class="sidebar-divider" />
                            <div id="section-choose" class="row">
                                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                    <h1 class="h3 mb-0 text-gray-800" id="titulo-choose">
                                        Selecione um Componente
                                    </h1>
                                </div>
                            </div>
                            <div id="section-analytics" class="row">
                                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                    <h1 class="h3 mb-0 text-gray-800" id="titulo-macAdress">
                                        Analytics
                                    </h1>
                                    <button id="btn-gerarRelatorio" class="btn-pdf btn btn-primary btn-sm" type="button">
                                        <i class="fa-solid fa-file-pdf"></i>
                                        Gerar Relatório
                                    </button>
                                </div>
                                <div class="row">
                                    <div class="col-xl-8 col-lg-7">
                                        <div class="card mb-4">
                                            <div
                                                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                <h6 id="titulo_grafico_linha" class="m-0 font-weight-bold text-primary">
                                                </h6>
                                                <div>
                                                    <span id="area-select-mes"></span>
                                                    <span id="area-select-metrica"></span>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="chart-area">
                                                    <div class="chartjs-size-monitor">
                                                        <div class="chartjs-size-monitor-expand">
                                                            <div class=""></div>
                                                        </div>
                                                        <div class="chartjs-size-monitor-shrink">
                                                            <div class=""></div>
                                                        </div>
                                                    </div>
                                                    <div class="chartjs-size-monitor">
                                                        <div class="chartjs-size-monitor-expand">
                                                            <div class=""></div>
                                                        </div>
                                                        <div class="chartjs-size-monitor-shrink">
                                                            <div class=""></div>
                                                        </div>
                                                    </div>
                                                    <canvas id="myAreaChart" style="display: block; width: 1013px; height: 320px; " width="1013" height="320" class="chartjs-render-monitor"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xl-7 col-lg-6">
                                        <div class="card card-h-100">
                                            <div
                                                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                <h6 class="m-0 font-weight-bold text-primary">
                                                    TITULO
                                                </h6>
                                            </div>
                                            <div id="imgGraficoR" class="grafico">
                                                <img 
                                                    id="loading"
                                                    src="" 
                                                    alt="" 
                                                    class="loading"
                                                    onerror="this.error=null; this.src='https://media.tenor.com/whis5JX19ycAAAAC/loading-load.gif'"
                                                >
                                                <img id="imgGraficoMetrica" class="graficoR" src="" >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-5 col-lg-6">
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="card h-md-100">
                                                    <div class="card-header pb-0">
                                                        <h6 class="mb-0 mt-2">Média do Mês</h6>
                                                    </div>
                                                    <div class="card-body d-flex flex-column justify-content-end">
                                                        <div class="row justify-content-between">
                                                            <div class="col-auto align-self-end">
                                                                <div id="span-mediaMes"
                                                                    class="fs-4 fw-normal text-700 lh-1 mb-1">
                                                                    -
                                                                </div>
                                                                <span id="span-badgeMediaMes" class="badge">
                                                                    <span id="icon-mediaMes" class=""></span>
                                                                    <span id="span-mediaMesEstatistica">0%</span>
                                                                </span>
                                                            </div>
                                                            <div class="col-auto ps-0 mt-n4"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="card h-md-100">
                                                    <div class="card-header pb-0">
                                                        <h6 class="mb-0 mt-2">Quantidade de Métricas</h6>
                                                    </div>
                                                    <div class="card-body d-flex flex-column justify-content-end">
                                                        <div class="row justify-content-between">
                                                            <div class="col-auto align-self-end">
                                                                <div id="span-qtdMetricas"
                                                                    class="fs-4 fw-normal text-700 lh-1 mb-1">
                                                                    -
                                                                </div>
                                                                <span class="fs--2 bg-200 text-primary">
                                                                    métrica(s)
                                                                </span>
                                                            </div>
                                                            <div class="col-auto ps-0 mt-n4"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div id="card-previsao" class="col-sm-6">
                                                <div class="card h-md-100">
                                                    <div class="card-header pb-0">
                                                        <h6 class="mb-0 mt-2">
                                                            Previsão (<span id="span-proxMes">Novembro</span>)
                                                        </h6>
                                                    </div>
                                                    <div class="card-body d-flex flex-column justify-content-end">
                                                        <div class="row justify-content-between">
                                                            <div class="col-auto align-self-end">
                                                                <div id="span-previsao"
                                                                    class="fs-4 fw-normal text-700 lh-1 mb-1">
                                                                    -
                                                                </div>
                                                                <span id="span-badgePrevisao" class="badge">
                                                                    <span id="icon-previsao"></span>
                                                                    <span id="span-previsaoEstatistica">-</span>
                                                                </span>
                                                            </div>
                                                            <div class="col-auto ps-0 mt-n4"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="card h-md-100">
                                                    <div class="card-header pb-0">
                                                        <h6 class="mb-0 mt-2">Status</h6>
                                                    </div>
                                                    <div class="card-body d-flex flex-column justify-content-end">
                                                        <div class="row justify-content-between">
                                                            <div class="col-auto align-self-end">
                                                                <div id="span-status"
                                                                    class="fs-4 fw-normal text-700 lh-1 mb-1">
                                                                    -
                                                                </div>
                                                                <span id="icon-status" class="badge"> </span>
                                                            </div>
                                                            <div class="col-auto ps-0 mt-n4"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- </div> -->
                                </div>
                            </div>
                            <div id="section-analytics-fan" class="row">
                                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                    <h1 class="h3 mb-0 text-gray-800" id="titulo-macAdress">
                                        Analytics
                                    </h1>
                                </div>
                                <div class="col-xl-8 col-lg-7">
                                    <div class="card mb-4">
                                        <div
                                            class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                            <h6 class="m-0 font-weight-bold text-primary">
                                                Gráfico de correlação entre RPM e Temperatura
                                            </h6>
                                        </div>
                                        <div class="card-body" style="height: 420px">
                                            <div class="chart-area-fan"
                                                style="height: 100%; position: relative; width: 100%">
                                                <canvas id="myChart" style="display: block; width: 100%; height: 100%"
                                                    width="1614" height="400" class="chartjs-render-monitor">
                                                </canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Message From Customer-->
                        </div>
                        <!--Row-->
                        <div class="row"></div>
                    </div>
                </div>
                <!---Container Fluid-->
            </div>
            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>AIR-DATA
                            <script>
                                document.write(new Date().getFullYear());
                            </script>
                            - DEVELOPED BY
                            <b><a target="_blank">SPTECH STUDENTS</a></b>
                        </span>
                    </div>
                </div>
            </footer>
            <!-- Footer -->
        </div>
    </div>
    <!-- Scroll to top -->
    <a class="scroll-to-top rounded" href="#page-top" style="display: inline">
        <i class="fas fa-angle-up"></i>
    </a>
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="../assets/js/ruang-admin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const chartPedro = Chart;
    </script>
    <script src="../assets/vendor/chart.js/Chart.min.js"></script>
    <script src="../assets/js/demo/chart-area-demo.js"></script>
    <script src="js/fan.js"></script>
    <script src="./js/script.js"></script>
    <script src="./js/dados.js"></script>
</body>

</html>

<script>
    //pegando os perâmetros da URL
    const urlParams = new URLSearchParams(window.location.search);
    const idMaquina = urlParams.get("idMaquina");
    //sim, a próxima linha é redundante. Se você removê-lá, entretanto, você quebrará todo o sistema
    sessionStorage.MAC_SERVIDOR = idMaquina;
    //old: const idMaquina = sessionStorage.MAC_SERVIDOR;
    validarUrlAcesso();

    //TO DO: REGISTRAR O ACESSO
    function validarUrlAcesso() {
        //verificando se estou logado
        if (sessionStorage.ID_USUARIO == undefined) {
            window.location.href = `../sing-in.html?urlAfterLogin=dashboard.html&idMaquina=${idMaquina}`;
        }
        //verificando acesso à máquina
        validarAcesso().then((acesso) => {
            if (!acesso) {
                alert("Máquina não encontrada ou acesso negado");
                window.location.href = "./maquinas.html";
            }
        });
        //registrando o acesso por QR Code
        if (urlParams.has("origin") && urlParams.get("origin") == "qrCode") {
            console.log("vou cadastrar no banco em");
            fetch("/acessoQrCode/cadastrarAcesso", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idUsuarioServer: sessionStorage.ID_USUARIO,
                    idMaquinaServer: idMaquina,
                }),
            });
        }
    }

    //Verificando se o usuário logado tem acesso à maquina
    async function validarAcesso() {
        retorno = await fetch("/maquinas/listarPorMacAeroporto", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idMaquinaServer: idMaquina,
                idAeroportoServer: sessionStorage.ID_AEROPORTO,
            }),
        });
        retornoJson = await retorno.json();
        if (retornoJson.length > 0) {
            return true;
        } else {
            return false;
        }
        return retornoJson;
    }

    const tempoCapturaCards = 1000;
    var tempoCapturaGrafico = 1000;

    var pagina = "dashboard";

    setTimeout(() => {
        criarTela();
        setTimeout(() => {
            iniciar();
            //console.log('chamou iniciar()')
        }, 100);
    }, 100);

    // Alterar tempo de captura do grafico

    function alterarCapturaGrafico(novoTempo) {
        tempoCapturaGrafico = novoTempo;
    }

    // Criando HTML dos cards

    function criarTela() {
        obterComponentes(idMaquina);
    }

    // Plotando dados dos cards

    function iniciar() {
        // Funções em ./js/dados.js
        obterDadosCards(idMaquina, "cpuPercent", "CPU", "Porcentagem de uso");
        obterDadosCards(idMaquina, "ramPercent", "RAM", "Porcentagem de uso");
        obterDadosCards(idMaquina, "diskPercent", "DISCO", "Porcentagem de uso");
        obterDadosCards(idMaquina, "cpuTemp", "CPU", "Temperatura");
        obterDadosCards(idMaquina, "fanView", "CPU", "Rotação da FAN");
    }

    // Pegando dados de porcentagem para os cards no topo da tela

    function plotarCards(metrica, dadosMaquina, nomeComponente, nomeMetrica) {
        var idToSnakeCase = tratarId(metrica);
        idToSnakeCase += dadosMaquina[0].idComponente;
        var idCard = document.getElementById(idToSnakeCase);

        var spanStatus = `status_${idToSnakeCase}`;
        spanStatus = document.getElementById(spanStatus);
        // console.log(spanStatus)

        var percent = dadosMaquina[0].valorLido;

        idCard.innerHTML = `${Math.round(percent, 0)}${dadosMaquina[0].unidadeMedida
            }`;

        if (percent < 70) {
            spanStatus.innerText = "ESTÁVEL";
            spanStatus.style.color = "green";
        } else if (percent <= 75) {
            spanStatus.innerText = "PERIGO";
            spanStatus.style.color = "black";
        } else if (percent <= 85) {
            spanStatus.innerText = "CRÍTICO";
            spanStatus.style.color = "rgb(223, 201, 2)";
        } else if (percent <= 95) {
            spanStatus.innerText = "RISCO DE FALHA";
            spanStatus.style.color = "orange";
        } else if (percent <= 100) {
            spanStatus.innerText = "FALHA";
            spanStatus.style.color = "red";
        }

        setTimeout(() => {
            obterDadosCards(idMaquina, metrica, nomeComponente, nomeMetrica);
        }, tempoCapturaCards);
    }

    // Pegando dados para plotar no gráfico de linha

    var idAtualPlotar = "";

    function plotarGrafico(
        metrica,
        resposta,
        idComponente,
        nomeMetrica,
        idMetrica,
        mes,
        tipoComponente,
        isSegundoEixo
    ) {
        sessionStorage.NOME_METRICA = nomeMetrica;
        sessionStorage.TIPO_COMPONENTE = tipoComponente;
        document.getElementById("section-choose").style.display = "none";
        document.getElementById("section-analytics").style.display = "block";
        document.getElementById("section-analytics-fan").style.display = "none";

        listarUltimosCincoMeses(
            metrica,
            idComponente,
            idMetrica,
            nomeMetrica,
            mes,
            tipoComponente,
            isSegundoEixo
        );
        receberMetricas(idMetrica, idComponente, nomeMetrica, tipoComponente);

        if (idAtualPlotar != idComponente) {
            idAtualPlotar = idComponente;
        }

        var dadosGrafico = [];
        var labelsGrafico = [];
        var dados, valorLido;

        if (isSegundoEixo) {
            for (var i = 0; i < resposta.length; i++) {
                dados = resposta[i];
                valorLido = dados.Media;

                dadosGrafico.push(valorLido);
            }
            myLineChart.data.datasets[1].data = dadosGrafico;
        } else {
            myLineChart.destroy();
            criarGraficoInicial(resposta[0].unidadeMedida);

            for (var i = 0; i < resposta.length; i++) {
                dados = resposta[i];
                valorLido = dados.Media;
                var unidadeMedida = dados.unidadeMedida;
                var dataHorario = dados.Dia;

                dadosGrafico.push(valorLido);
                labelsGrafico.push(dataHorario);

                sessionStorage.DADOS_GRAFICO = JSON.stringify(resposta);
            }

            myLineChart.data.datasets[0].data = dadosGrafico;
            myLineChart.data.labels = labelsGrafico;
        }

        myLineChart.update();

        titulo_grafico_linha.innerHTML =
            "MÉDIA POR DIA DA " + nomeMetrica.toUpperCase();
    }

    function listarTabelaAlertas(listaAlertas) {
        var bodyTable = document.getElementById("corpo-tabela-alertas");
        bodyTable.innerHTML = "";

        for (i = 0; i < listaAlertas.length; i++) {
            var mac = listaAlertas[i].idServidor;
            mac = mac.replace(/:/g, "-").toUpperCase();

            var dataHorario = listaAlertas[i].momentoAlerta.split("T");
            dataHorario = [
                dataHorario[0].replace(/-/g, "/"),
                dataHorario[1].slice(0, 8),
            ];

            bodyTable.innerHTML += `
            <tr>
                <td>${listaAlertas[i].idAlerta}</td>
                <td>${listaAlertas[i].statusAlerta}</td>
                <td>${listaAlertas[i].tipoComponente}</td>
                <td>${dataHorario}</td>
            </tr>
            `;
        }
    }

    const meses = new Array(
        "Janeiro",
        "Fevereiro",
        "Março",
        "Abril",
        "Maio",
        "Junho",
        "Julho",
        "Agosto",
        "Setembro",
        "Outubro",
        "Novembro",
        "Dezembro"
    );

    var idMetricaAtual;

    function listarUltimosCincoMeses(
        metrica,
        idComponente,
        idMetrica,
        nomeMetrica,
        mes,
        tipoComponente,
        isSegundoEixo
    ) {
        const hoje = new Date();
        const mesesLabel = [];
        var datas = dataNosUltimosCincoMeses(hoje);

        const areaSelectMes = document.getElementById("area-select-mes");

        for (let i = 1; i <= 5; i++) {
            mesesLabel.push(meses[mesAnterior(hoje, i * -1).getMonth()]);
        }

        idMetricaAtual = isSegundoEixo ? idMetricaAtual : idMetrica;

        areaSelectMes.innerHTML = `
        <select class="dropdown-toggle btn btn-sm btn-select" id="selecionar-mes" onchange="obterDadosGrafico('${sessionStorage.MAC_SERVIDOR}', '${metrica}', ${idComponente}, '${nomeMetrica}', ${idMetricaAtual}, null, '${tipoComponente}', false)">
            <option value="null">Selecionar o Mês</option>
        </select>
        `;

        const selectMes = document.getElementById("selecionar-mes");

        selectMes.innerHTML = '<option value="null">Selecionar o Mês</option>';
        for (let i = 0; i < 5; i++) {
            selectMes.innerHTML += `
                <option value='${datas[i]}'>${mesesLabel[i]}</option>'
            `;
        }
        document.getElementById("selecionar-mes").value = mes;
    }

    function mesAnterior(date, diff) {
        const data = new Date(date);
        data.setMonth(data.getMonth() + diff);
        return data;
    }

    function dataNosUltimosCincoMeses(data) {
        const datas = [];

        for (let i = 1; i <= 5; i++) {
            datas.push(mesAnterior(data, i * -1).getMonth() + 1);
        }

        return datas;
    }

    function listarMetricasDisponiveis(
        metricas,
        idComponente,
        idMetrica,
        nomeMetrica,
        tipoComponente
    ) {
        console.log(nomeMetrica);
        const areaSelectMetrica = document.getElementById("area-select-metrica");

        areaSelectMetrica.innerHTML = `
        <select class="dropdown-toggle btn btn-sm btn-select" id="selecionar-metrica" onchange="obterDadosGrafico('${sessionStorage.MAC_SERVIDOR}', 'mediaPorDia', ${idComponente}, '${nomeMetrica}', null, null, '${tipoComponente}', true)">
            <option value="null">Selecionar a Métrica</option>
        </select>
        `;

        const selectMetrica = document.getElementById("selecionar-metrica");

        for (let i = 0; i < metricas.length; i++) {
            selectMetrica.innerHTML += `
                <option value="${metricas[i].idMetrica}">${metricas[i].nomeMetrica}</option>
            `;
        }
    }

    async function exibirDadosAnalytics(res, idComponente, idMetrica, mes) {
        sessionStorage.MES_ATUAL = parseInt(mes);

        var spanMediaMes = document.getElementById("span-mediaMes");
        var spanQtdMetricas = document.getElementById("span-qtdMetricas");
        var spanMediaMesEstatistica = document.getElementById(
            "span-mediaMesEstatistica"
        );
        var iconMediaMes = document.getElementById("icon-mediaMes");
        var spanBadgeMediaMes = document.getElementById("span-badgeMediaMes");
        var spanStatus = document.getElementById("span-status");
        var iconStatus = document.getElementById("icon-status");
        var spanPrevisao = document.getElementById("span-previsao");
        var spanBadgePrevisao = document.getElementById("span-badgePrevisao");
        var iconPrevisao = document.getElementById("icon-previsao");
        var spanPrevisaoEstatistica = document.getElementById(
            "span-previsaoEstatistica"
        );
        var spanProxMes = document.getElementById("span-proxMes");

        console.log(res);

        spanProxMes.innerText = meses[parseInt(mes)];

        var mediaUso = parseFloat(res[1].media);
        var diferencaMediaMes = mediaUso - parseFloat(res[0].media);

        console.log(
            mediaUso,
            parseFloat(res[0].media),
            mediaUso - parseFloat(res[0].media)
        );

        diferencaMediaMes =
            diferencaMediaMes.toFixed(0) == 0 ? 0 : diferencaMediaMes;

        var classeAtualMediaMes = "";

        if (diferencaMediaMes > 0) {
            spanBadgeMediaMes.style.color = "#d33";
            iconMediaMes.className = "fa fa-caret-up me-1";
            classeAtualMediaMes = "fa fa-caret-up me-1";
        }

        if (diferencaMediaMes == 0) {
            spanBadgeMediaMes.style.color = "#5A5C69";
            iconMediaMes.className = "fa-solid fa-minus me-1";
            classeAtualMediaMes = "fa-solid fa-minus me-1";
        }

        if (diferencaMediaMes < 0) {
            spanBadgeMediaMes.style.color = "#0d6efd";
            iconMediaMes.className = "fa fa-caret-down me-1";
            classeAtualMediaMes = "fa fa-caret-down me-1";
        }

        if (mediaUso > 75) {
            iconStatus.style.color = "#d33";
            spanStatus.innerText = "Mau estado";
            iconStatus.innerHTML = '<i class="fa-solid fa-xmark"></i>';
        } else {
            iconStatus.style.color = "#0d6efd";
            spanStatus.innerText = "Bom estado";
            iconStatus.innerHTML = '<i class="fa-sharp fa-solid fa-check"></i>';
        }

        spanMediaMes.innerText = mediaUso.toFixed(0) + res[0].unidadeMedida;
        spanMediaMesEstatistica.innerText =
            diferencaMediaMes.toFixed(0) + res[0].unidadeMedida;
        spanQtdMetricas.innerText = res.length;

        var previsao = null;
        var diferencaMediaMesPrevisao = null;

        if (parseInt(mes) == new Date().getMonth()) {
            document.getElementById("card-previsao").style.display = "block";

            previsao = await preverDadosProximoMes(idComponente, idMetrica, mes);
            diferencaMediaMesPrevisao = previsao - mediaUso;

            diferencaMediaMesPrevisao =
                diferencaMediaMesPrevisao.toFixed(0) == 0
                    ? 0
                    : diferencaMediaMesPrevisao;

            var classeAtualPrevisao = "";

            if (diferencaMediaMesPrevisao > 0) {
                spanBadgePrevisao.style.color = "#d33";
                iconPrevisao.className = "fa fa-caret-up me-1";
                classeAtualPrevisao = "fa fa-caret-up me-1";
            }

            if (diferencaMediaMesPrevisao == 0) {
                spanBadgePrevisao.style.color = "#5A5C69";
                iconPrevisao.className = "fa-solid fa-minus me-1";
                classeAtualPrevisao = "fa-solid fa-minus me-1";
            }

            if (diferencaMediaMesPrevisao < 0) {
                spanBadgePrevisao.style.color = "#0d6efd";
                iconPrevisao.className = "fa fa-caret-down me-1";
                classeAtualPrevisao = "fa fa-caret-down me-1";
            }

            spanPrevisao.innerText = previsao.toFixed(0) + res[0].unidadeMedida;
            spanPrevisaoEstatistica.innerText =
                diferencaMediaMesPrevisao.toFixed(0) + res[0].unidadeMedida;
        } else {
            document.getElementById("card-previsao").style.display = "none";
        }

        console.log(previsao, diferencaMediaMesPrevisao);

        var dadosAnalytics = [
            {
                media: mediaUso.toFixed(0),
                diferenca: diferencaMediaMes.toFixed(0),
                unidadeMedida: res[0].unidadeMedida,
            },
            {
                media: previsao,
                diferenca: diferencaMediaMesPrevisao,
                unidadeMedida: res[0].unidadeMedida,
            },
            { media: res.length, diferenca: null, unidadeMedida: null },
        ];

        sessionStorage.DADOS_ANALYTICS = JSON.stringify(dadosAnalytics);

        console.log(sessionStorage.DADOS_ANALYTICS);
    }

    var tituloMacAdress = document.getElementById("titulo-macAdress");
    var btnGerenciarComponentes = document.getElementById(
        "btn-gerenciarComponentes"
    );
    var btnGerarRelatorio = document.getElementById("btn-gerarRelatorio");
    var btnGerenciarProcessos = document.getElementById("btn-gerenciarProcessos");

    btnGerenciarComponentes.addEventListener("click", () => {
        window.location = "./componentes.html";
    });

    btnGerenciarProcessos.addEventListener("click", () => {
        window.location = "./processos.html";
    });

    tituloMacAdress.addEventListener("click", () => {
        console.log("click");
        document.getElementById("section-analytics").style.display = "none";
        document.getElementById("section-choose").style.display = "flex";
    });

    btnGerarRelatorio.addEventListener("click", () => {
        window.open("./relatorio.html");
    });
</script>
